# [CALC-STEM-RTM] Универсальный расчет протечек пара через уплотнения штоков (2-5 участков)

**Версия документа:** 1.0<br>
**Статус:** Черновик<br>
**Ответственный:** @D0k2<br>
**Участники:** -

## 1. Назначение и Цели
Методика описывает алгоритм расчета массового расхода пара через щелевые уплотнения штоков клапанов.

## 2. Источники и Нормативы
*   [1] РТМ 108.020.33-86 Уплотнения лабиринтные стационарных паровых и гховых турбин и компрессоров. Проектирование и расчет / Раздел 5.4 С.35-37.
*   [2] IAPWS-IF97 (свойства воды и водяного пара).

## 3. Входные данные (User Inputs)

### 3.1. Геометрия клапана (из БД)
Данные подгружаются автоматически по ID клапана. Количество участков $N_{total}$ определяется автоматически исходя из наличия длин участков ($L_1...L_5$).

| Параметр | Код переменной (Internal API) | Символ | Единица | Описание |
| :--- | :--- | :---: | :---: | :--- |
| Диаметр штока | `dimension.metal...rod-diameter` | $d$ | мм | |
| Радиус скругления | `dimension.metal...rounding-radius` | $r$ | мм | Ширина фаски / радиус скругления |
| Радиальный зазор | `dimension.metal...radial-clearance` | $\delta$ | мм | |
| Длина участка $i$ | `dimension.metal...length-of-plot-[i]` | $L_i$ | мм | Где $i \in [1..5]$ |
| Количество клапанов | `quantity...number-of-plots` | $Z$ | шт | Число однотипных клапанов |

### 3.2. Термодинамические параметры (User Inputs)

| Параметр | Код | Символ | Описание |
| :--- | :--- | :---: | :--- |
| Давление свежего пара | `pressure_inlet` | $P_0$ | Давление перед клапаном |
| Температура / Энтальпия | `temp_inlet` / `h_inlet` | $T_0 / h_0$ | Параметры перед клапаном |
| Давление воздуха | `pressure_air` | $P_{air}$ | Барометрическое давление |
| Температура воздуха | `temp_air` | $T_{air}$ | |
| Давление в отсосе $j$ | `pressure_suction_[j]` | $P_{s,j}$ | Давление в камере отсоса $j$ |

> Примечание:
> 1. Количество полей для давлений отсосов зависит от топологии (см. Раздел 4).

## 4. Топология

**Авто-топология:**
Количество отсосов рассчитывается как:

$$ N_{suctions} = N_{total} - 1 $$

> Примечание:
> 1. Последний участок всегда граничит с воздухом.

**Распределение давлений:**
Логика формирования перепадов давления для расчета каждого участка $P_{start} \to P_{end}$.

| Кол-во участков ($N_{total}$) | Кол-во отсосов | Участок 1 | Участок 2 | Участок 3 | Участок 4 | Участок 5 |
| :---: | :---: | :--- | :--- | :--- | :--- | :--- |
| **2** | 1 | $P_0 \to P_{s1}$ | $P_{air} \to P_{s1}$ | - | - | - |
| **3** | 2 | $P_0 \to P_{s1}$ | $P_{s1} \to P_{s2}$ | $P_{air} \to P_{s2}$ | - | - |
| **4** | 3 | $P_0 \to P_{s1}$ | $P_{s1} \to P_{s2}$ | $P_{s2} \to P_{s3}$ | $P_{air} \to P_{s3}$ | - |
| **5** | 4 | $P_0 \to P_{s1}$ | $P_{s1} \to P_{s2}$ | $P_{s2} \to P_{s3}$ | $P_{s3} \to P_{s4}$ | $P_{air} \to P_{s4}$ |

> Примечаине:
> 1. Последний участок для каждого случая это соединение с воздухом $P_{air}$ и $P_{suction\_last}$ являются граничными условиями.

## 5. Свойства среды и Константы

### 5.1. Свойства пара (IF97)

| Параметр | Функция / Источник | Зависимость | Единица |
| :--- | :--- | :---: | :---: |
| Энтальпия входа | `pt2h` | $h_0 = f(P_0, T_0)$ | ккал/кг* |
| Удельный объем | `ph2v` | $v = f(P, h)$ | м³/кг |
| Динамическая вязкость | `ph2visc` | $\mu = f(P, h)$ | Па·с |
| Температура насыщения | `p2tsat` | $T_{sat} = f(P)$ | °С |

> Примечание: 
> 1. Процесс считается **изоэнтальпийным** ($h = const$) по тракту движения пара.

### 5.2. Коэффициенты гидравлики (Lookups)
Используются эмпирические зависимости из РТМ. См. Приложение А.

*   **LAMBDA_CALC(Re):** Коэффициент трения $\lambda$ в зависимости от числа Рейнольдса.
*   **KSI_CALC(A):** Коэффициент местного сопротивления (смягчения) входа $\xi$ в зависимости от геометрического фактора $A = r / (2\delta)$.

## 7. Алгоритм расчета

### Шаг 1. Инициализация геометрии
Площадь проходного сечения (одинакова для всех участков):

$$ f = \pi \cdot d \cdot \delta $$

> Примечание:
> 1. Параметры $d$ и $\delta$ переводим в [м]

Коэффициент местного сопротивления входа (общий):

$$ \xi = \text{KSI\_CALC}\left( \frac{r}{2\delta} \right) $$

> Примечание:
> 1. Параметры $r$ и $\delta$ переводим в [м]

### Шаг 2. Универсальный цикл расчета паровых участков
Расчет выполняется только для участков, где рабочим телом является пар. Согласно топологии (раздел 4), это участки с индексами от **1** до **$N_{total}-1$**.
*(Последний участок — воздушный, исключен из расчета расхода).*

**Цикл по $i$ от 1 до $N_{total}-1$:**

1.  **Определение давлений ($P_{start}, P_{end}$):**
    *   Если $i = 1$: $P_{start} = P_0$, $P_{end} = P_{s1}$.
    *   Если $i > 1$: $P_{start} = P_{s(i-1)}$, $P_{end} = P_{si}$.

2.  **Определение свойств среды:**
    *   Энтальпия $h = h_0$ (const).
    *   Удельный объем $v_i = f(P_{start}, h)$.
    *   Вязкость $\mu_i = f(P_{start}, h) \to \nu_i = v_i \cdot \mu_i$.

3.  **Итерационный расчет скорости ($W_i$):**
    *   *Начальное приближение:* $W_{guess}$.
    *   *Число Рейнольдса:* $Re_i = (W_{guess} \cdot 2\delta) / \nu_i$.
    *   *Коэффициент трения:* $\lambda_i = \text{LAMBDA\_CALC}(Re_i)$.
    *   *Коэффициент расхода:*
    
$$ \alpha_i = \frac{1}{\sqrt{1 + \xi + \frac{0.5 \cdot \lambda_i \cdot L_i}{\delta}}} $$
    
    -   *Расчет массового расхода (т/ч):*
    
$$ G_i = \alpha_i \cdot f \cdot \sqrt{\frac{P_{start}^2 - P_{end}^2}{P_{start} \cdot v_i}} \cdot 3.6 $$
    
    -   *Проверка сходимости:*
    
$$ \Delta W = W_{guess} - \frac{v_i \cdot G_i}{3.6 \cdot f} $$
    
    -   *Корректировка:* Решатель изменяет $W_{guess}$, пока $|\Delta W| \le 0.001$.

### Шаг 3. Агрегация результатов
После расчета расходов $G_i$ по каждому участку:

1.  **Расходы в отсосы (для одного клапана):**
    *   В отсос $j$ поступает пар из участка $j$ и уходит в участок $j+1$.
    *   Для последнего чисто парового отсоса — весь пар уходит в коллектор.
    *   *Формула:* $G_{suction, j} = G_j - G_{j+1}$ (где $G_{last} = 0$, т.к. воздушный участок не дает пара).

2.  **Суммирование по количеству клапанов ($Z$):**

    $$ G_{total, j} = G_{suction, j} \cdot Z $$

4.  **Общий расход свежего пара на уплотнения:**

    $$ G_{system} = G_1 \cdot Z $$

## 8. Выходные данные (Outputs)

Формат вывода соответствует требованиям BR-04 и BR-06.

| Параметр | Переменная (JSON) | Единица | Округление (UI) | Описание |
| :--- | :--- | :---: | :---: | :--- |
| Общий расход пара | `flow_steam_total` | т/ч | 0.01 | Суммарно на все клапаны |
| Расход в отсос 1 | `flow_suction_1` | т/ч | 0.01 | |
| ... | ... | ... | ... | |
| Расход в отсос N | `flow_suction_N` | т/ч | 0.01 | |
| Энтальпия отсосов | `enthalpy_suction_[j]` | ккал/кг | 0.1 | Соответствует $h_0$ |
| Температура отсосов | `temp_suction_[j]` | °С | 0.1 | $T_{sat}$ или $T(P_{sj}, h_0)$ |

## 9. Контрольный пример (Verification)

**Сценарий:** 3 участка (Steam -> S1 -> S2 <- Air).
*   $P_0 = 100$ бар, $P_{s1} = 5$ бар, $P_{s2} = 0.9$ бар.
*   Расчет выполняется для участков 1 и 2.

**Ожидаемый результат:**
1.  $G_1$ (Уч. 1) > $G_2$ (Уч. 2).
2.  Расход в Отсос 1 = $(G_1 - G_2) \cdot Z$.
3.  Расход в Отсос 2 = $G_2 \cdot Z$ (так как встречный поток воздуха не рассчитывается, считаем, что весь пар уходит в отсос).
4.  В UI отображаются давления с точностью 4 знака, расходы 2 знака.

---

### Приложение А. Матрицы коэффициентов

#### A.1. Коэффициент трения $\lambda = f(Re)$
РТМ 108.020.33-86 / С.36 / Таблица 10 / Коэффициенты сопротивления трения **$\lambda$** в зависимости от числа Рейнольдса **$Re$**

<img width="1027" height="507" alt="image" src="https://github.com/user-attachments/assets/f9ac2777-dccb-42fc-9823-4f8b5255da51" />

**Matrix_LAMBDA:**
*   **X (Re):** `[100, 200, 300, 400, 500, 600, 700, 800, 900, 1000, 1100, 1200, 1300, 1400, 1500, 1600, 1700, 1800, 1900, 2000, 2500, 3000, 4000, 5000,	6000, 8000, 10000, 15000, 20000, 30000, 40000, 50000, 60000, 80000, 100000, 150000, 200000, 300000, 400000,	500000, 600000, 800000, 1000000, 1500000, 2000000, 3000000, 4000000, 5000000, 8000000, 10000000, 15000000, 20000000, 30000000, 60000000, 80000000, 100000000]`
*   **Y ($\lambda$):** `[0.640, 0.320, 0.213, 0.160, 0.128, 0.107, 0.092, 0.080, 0.071, 0.064, 0.058, 0.053, 0.049, 0.046, 0.043, 0.040, 0.038, 0.036, 0.034, 0.032,	0.034, 0.040, 0.040, 0.038, 0.036, 0.033, 0.032, 0.028, 0.026, 0.024, 0.022, 0.021, 0.020, 0.019, 0.018, 0.017,	0.016, 0.015, 0.014, 0.013, 0.013, 0.012, 0.012, 0.011, 0.011, 0.010, 0.010, 0.009, 0.009, 0.008, 0.008, 0.008, 0.007, 0.007,	0.006, 0.006]`

#### A.2. Коэффициент входа $\xi = f(r / 2\delta)$
РТМ 108.020.33-86 / С.36 / Таблица 11 / Коэффициенты смягчения входа **$\xi$** в зависимости от отношения **$r / 2\delta$**

<img width="1060" height="129" alt="image" src="https://github.com/user-attachments/assets/05d9bdcc-f93c-42de-a61a-11ec8fbdb531" />

**Matrix_KSI:**
*   **X ($k_{prop}$):** `[0.00, 0.01, 0.02, 0.03, 0.04, 0.05, 0.06, 0.08, 0.12, 0.16, 0.20, 10.0]`
*   **Y ($\xi$):** `[0.50, 0.43, 0.36, 0.31, 0.26, 0.22, 0.20, 0.15, 0.09, 0.06, 0.03, 0.03]`
